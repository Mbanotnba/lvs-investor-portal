<!DOCTYPE html>
<!--
================================================================================
LVS CUSTOMER PORTAL - MOCKUP
================================================================================
Version: 1.0
Last Updated: January 28, 2026
Status: MOCKUP - Feature decommissioned until launch

OVERVIEW:
  This is a customer-facing portal for NDA-signed partners. Each customer
  would see their own engagement progress, product information, and documents.
  Currently showing Mach Industries as example customer.

STRUCTURE:
  - 7 Tabs: Dashboard | Product | Specifications | DevKit | SDK | Docs | Support
  - Single-page app using vanilla JS tab switching (no framework)
  - All CSS in <style> block, all JS in <script> block at bottom

CUSTOMIZATION POINTS:
  - Customer name: Search for "Mach Industries" to replace
  - Engagement stage: Modify .stage-dot classes (complete/current/upcoming)
  - Status: Stalled - awaiting responses
================================================================================
-->
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https:; connect-src 'self' https://lvs-api-657638018776.us-central1.run.app; frame-src https://docs.google.com;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mach Industries Portal | Lola Vision Systems</title>
    <link rel="stylesheet" href="css/shared-portal.css?v=20260208">
    <script src="js/config.js"></script>
    <script src="js/security.js"></script>
    <script src="js/account-settings.js"></script>
    <script src="js/comments.js"></script>
    <script src="js/shared-tabs.js?v=20260208"></script>
    <script src="js/nda-gate.js"></script>
    <script>
        (function() {
            const SESSION_TIMEOUT = 30 * 60 * 1000;
            const timestamp = sessionStorage.getItem('lvs_session_timestamp');
            const auth = sessionStorage.getItem('lvs_auth');
            if (auth !== 'true') { window.location.href = 'login.html'; return; }
            if (timestamp && (Date.now() - parseInt(timestamp, 10)) > SESSION_TIMEOUT) {
                sessionStorage.clear(); window.location.href = 'login.html?session=expired'; return;
            }
            sessionStorage.setItem('lvs_session_timestamp', Date.now().toString());
        })();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <img src="assets/lvs-logo.webp" alt="LVS" class="nav-logo">
            <div class="nav-title">LOLA VISION <span>SYSTEMS</span></div>
        </div>
        <div class="nav-user">
            <a href="software-platform.html" class="nav-link" style="margin-right: 16px;">Software Platform</a>
            <a href="founder-portal.html" class="nav-link" style="margin-right: 16px;">&#8592; Founder Portal</a>
            <span class="customer-badge">Customer Portal</span>
            <span id="navGreeting" class="nav-greeting"></span>
            <div class="nav-avatar" id="navAvatar">--</div>
            <a href="login.html" class="nav-link" onclick="sessionStorage.clear()">Logout</a>
        </div>
    </nav>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="product">Product<span class="badge">LVS-250</span></button>
        <button class="tab-btn" data-tab="specs">Specs</button>
        <button class="tab-btn" data-tab="software-platform">Software Platform</button>
        <button class="tab-btn" data-tab="devkit">Dev Kit</button>
        <button class="tab-btn" data-tab="demos">Demos</button>
        <button class="tab-btn" data-tab="testimonials">Testimonials</button>
        <button class="tab-btn" data-tab="documents">Documents</button>
        <button class="tab-btn" data-tab="support">Support</button>
    </div>

    <div class="container">
        <!-- ==================== DASHBOARD TAB ==================== -->
        <div id="dashboard" class="tab-content active">
            <!-- Welcome Header -->
            <div class="welcome">
                <div class="welcome-content">
                    <h1>Welcome back, <span>Mach Industries</span></h1>
                    <p>Your partnership dashboard - Last updated January 28, 2026</p>
                </div>
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 24px 32px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <span style="font-size: 22px; font-weight: 800; color: white; letter-spacing: 2px;">MACH</span>
                </div>
            </div>

            <!-- Stalled Status Banner -->
            <div class="stalled-banner">
                <span class="stalled-banner-icon">&#9888;</span>
                <div class="stalled-banner-content">
                    <div class="stalled-banner-title">Engagement Status: Stalled</div>
                    <div class="stalled-banner-text">Awaiting response on IRAD proposal signature and US Army pitch invitation. Last outreach: January 2026.</div>
                </div>
            </div>

            <!-- Stage Progress Tracker -->
            <div class="stage-tracker">
                <h2>Engagement Progress</h2>
                <div class="stages">
                    <div class="stage">
                        <div class="stage-dot complete">&#10003;</div>
                        <span class="stage-label">Discovery</span>
                        <span class="stage-date">Sep 2025</span>
                    </div>
                    <div class="stage">
                        <div class="stage-dot complete">&#10003;</div>
                        <span class="stage-label">NDA Signed</span>
                        <span class="stage-date">Oct 2025</span>
                    </div>
                    <div class="stage active">
                        <div class="stage-dot current">3</div>
                        <span class="stage-label">Evaluation</span>
                        <span class="stage-date">Stalled</span>
                    </div>
                    <div class="stage">
                        <div class="stage-dot upcoming">4</div>
                        <span class="stage-label">IRAD Contract</span>
                        <span class="stage-date">TBD</span>
                    </div>
                    <div class="stage">
                        <div class="stage-dot upcoming">5</div>
                        <span class="stage-label">Integration</span>
                        <span class="stage-date">TBD</span>
                    </div>
                    <div class="stage">
                        <div class="stage-dot upcoming">6</div>
                        <span class="stage-label">Production</span>
                        <span class="stage-date">2027+</span>
                    </div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="grid">
                <div>
                    <div class="panel">
                        <h3>Engagement Milestones</h3>
                        <div class="milestone">
                            <div class="milestone-icon complete">&#10003;</div>
                            <div class="milestone-content">
                                <div class="milestone-title">Initial Contact</div>
                                <div class="milestone-date">September 2025</div>
                            </div>
                            <span class="milestone-badge complete">Complete</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-icon complete">&#10003;</div>
                            <div class="milestone-content">
                                <div class="milestone-title">NDA Executed</div>
                                <div class="milestone-date">October 2025</div>
                            </div>
                            <span class="milestone-badge complete">Complete</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-icon complete">&#10003;</div>
                            <div class="milestone-content">
                                <div class="milestone-title">IRAD Proposal Submitted</div>
                                <div class="milestone-date">November 2025</div>
                            </div>
                            <span class="milestone-badge complete">Complete</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-icon stalled">&#9679;</div>
                            <div class="milestone-content">
                                <div class="milestone-title">IRAD Proposal - Awaiting Signature</div>
                                <div class="milestone-date">Pending response</div>
                            </div>
                            <span class="milestone-badge stalled">Stalled</span>
                        </div>
                        <div class="milestone">
                            <div class="milestone-icon stalled">&#9679;</div>
                            <div class="milestone-content">
                                <div class="milestone-title">US Army IEW&S/C5ISR Pitch Invitation</div>
                                <div class="milestone-date">January 2026 - Awaiting response</div>
                            </div>
                            <span class="milestone-badge stalled">Stalled</span>
                        </div>
                    </div>

                    <!-- Pending Actions -->
                    <div class="panel" style="margin-top: 24px; border-left: 3px solid var(--stalled);">
                        <h3>Pending Actions</h3>
                        <div class="pending-action">
                            <div class="pending-action-header">
                                <span class="pending-action-icon">&#128196;</span>
                                <span class="pending-action-title">IRAD Proposal Signature</span>
                            </div>
                            <div class="pending-action-desc">
                                IRAD proposal submitted November 2025. Awaiting Mach Industries signature to proceed with joint development agreement.
                            </div>
                            <span class="pending-action-status">Awaiting Response</span>
                        </div>
                        <div class="pending-action">
                            <div class="pending-action-header">
                                <span class="pending-action-icon">&#127919;</span>
                                <span class="pending-action-title">US Army Pitch Invitation</span>
                            </div>
                            <div class="pending-action-desc">
                                Email invitation sent to join LVS pitch to US Army IEW&S and C5ISR. Potential joint presentation opportunity.
                            </div>
                            <span class="pending-action-status">Awaiting Response</span>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="panel">
                        <h3>Your LVS Contact</h3>
                        <div class="contact-card">
                            <h4>Dedicated Support</h4>
                            <div class="contact-person">
                                <div class="contact-avatar">TA</div>
                                <div class="contact-info">
                                    <h5>Tayo Adesanya</h5>
                                    <p>CEO &bull; Lola Vision Systems</p>
                                </div>
                            </div>
                            <div class="contact-actions" style="flex-direction: column; gap: 8px;">
                                <div style="display: flex; gap: 8px;">
                                    <a href="https://wa.me/16304792126" target="_blank" class="contact-btn primary" style="text-decoration: none; text-align: center;">WhatsApp</a>
                                    <a href="sms:+16304792126" class="contact-btn secondary" style="text-decoration: none; text-align: center;">iMessage</a>
                                </div>
                                <a href="mailto:tayo@lolavisionsystems.com" class="contact-btn secondary" style="text-decoration: none; text-align: center; width: 100%;">Email</a>
                            </div>
                        </div>
                    </div>
                    <div class="panel" style="margin-top: 24px;">
                        <h3>Partnership Summary</h3>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(234,179,8,0.1); border-radius: 8px;">
                                <span style="color: var(--muted); font-size: 13px;">Engagement Status</span>
                                <span style="font-weight: 700; color: var(--stalled);">Stalled</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <span style="color: var(--muted); font-size: 13px;">Target Product</span>
                                <span style="font-weight: 600; color: var(--accent);">LVS-250</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <span style="color: var(--muted); font-size: 13px;">Application</span>
                                <span style="font-weight: 600;">Kamikaze Drones</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <span style="color: var(--muted); font-size: 13px;">Production Target</span>
                                <span style="font-weight: 600;">2027+</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Requirements Survey -->
            <div class="panel" style="border-left: 3px solid #06b6d4; margin-top: 24px;">
                <h3 style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">&#128203;</span> Requirements Survey
                    <span style="background: rgba(6,182,212,0.2); color: #06b6d4; padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 600; margin-left: auto;">CUSTOMER FEEDBACK</span>
                </h3>
                <p style="color: var(--muted); font-size: 13px; margin-top: 8px; margin-bottom: 20px;">
                    Help us understand your mission requirements so we can tailor the LVS solution to your needs.
                </p>
                <iframe
                    src="https://docs.google.com/forms/d/e/1FAIpQLSdDf1Ma_mO-4EBN_ZtDOznk2eHhBiX2ujCnh-wF9Oi0qfIygQ/viewform?embedded=true"
                    width="100%"
                    height="400"
                    frameborder="0"
                    marginheight="0"
                    marginwidth="0"
                    style="border-radius: 12px; background: var(--panel-light);">
                    Loading...
                </iframe>
            </div>

            <!-- Notes Section -->
            <div class="notes-section">
                <div class="grid">
                    <!-- Private Notes -->
                    <div class="notes-panel">
                        <h3>
                            My Notes
                            <span class="notes-badge private">Private</span>
                        </h3>
                        <textarea
                            class="notes-textarea"
                            id="privateNotes"
                            placeholder="Add your private notes here. These are saved locally on your device and only visible to you..."
                        ></textarea>
                        <div class="notes-actions">
                            <div class="notes-meta">
                                <span id="privateNotesMeta">No notes saved</span>
                            </div>
                            <div class="notes-buttons">
                                <button class="notes-btn secondary" onclick="exportNotes('private')">Export</button>
                                <button class="notes-btn primary" onclick="saveNotes('private')">Save</button>
                            </div>
                        </div>
                    </div>

                    <!-- Account Notes (Shared) -->
                    <div class="notes-panel">
                        <h3>
                            Account Notes
                            <span class="notes-badge" style="background: rgba(16,185,129,0.2); color: #10b981;">Synced</span>
                        </h3>
                        <div id="accountCommentsContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== PRODUCT TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="product" class="tab-content"></div>

        <!-- ==================== SPECS TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="specs" class="tab-content"></div>

        <!-- ==================== DEVKIT TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="devkit" class="tab-content"></div>

        <!-- ==================== SOFTWARE PLATFORM TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="software-platform" class="tab-content"></div>

        <!-- ==================== DOCUMENTS TAB ==================== -->
        <div id="documents" class="tab-content">
            <div class="welcome" style="margin-bottom: 24px;">
                <div class="welcome-content">
                    <h1>Partner <span>Documents</span></h1>
                    <p>Agreements, proposals, and technical documentation</p>
                </div>
            </div>
            <!-- Dynamic NDA Documents -->
            <div class="panel" id="ndaDocsPanel" style="display: none; margin-bottom: 24px;">
                <h3>Your Executed NDAs</h3>
                <div id="ndaDocsList">
                    <div style="color: var(--muted); font-size: 13px;">Loading...</div>
                </div>
            </div>

            <div class="panel">
                <h3>Available Documents</h3>
                <div style="display: flex; align-items: center; gap: 14px; padding: 14px; background: var(--panel-light); border-radius: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--success);">&#128196;</div>
                    <div style="flex: 1;">
                        <div style="font-size: 13px; font-weight: 600;">Mutual NDA</div>
                        <div style="font-size: 11px; color: var(--muted);">Executed October 2025</div>
                    </div>
                    <span style="color: var(--success); font-size: 12px;">&#10003; Signed</span>
                </div>
                <div style="display: flex; align-items: center; gap: 14px; padding: 14px; background: var(--panel-light); border-radius: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background: rgba(234, 179, 8, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--stalled);">&#128196;</div>
                    <div style="flex: 1;">
                        <div style="font-size: 13px; font-weight: 600;">IRAD Proposal</div>
                        <div style="font-size: 11px; color: var(--muted);">Submitted November 2025</div>
                    </div>
                    <span style="color: var(--stalled); font-size: 12px;">Awaiting Signature</span>
                </div>
            </div>
        </div>

        <!-- ==================== SUPPORT TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="support" class="tab-content"></div>

        <!-- ==================== DEMOS TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="demos" class="tab-content"></div>

        <!-- ==================== TESTIMONIALS TAB ==================== -->
        <!-- Content loaded from js/shared-tabs.js -->
        <div id="testimonials" class="tab-content"></div>

        <footer class="footer">
            <p>Lola Vision Systems &bull; Customer Portal &bull; Confidential</p>
            <p style="margin-top: 4px; opacity: 0.6;">For support: partners@lolavisionsystems.com</p>
        </footer>
    </div>

    <!-- Coming Soon Banner -->
    <div class="coming-soon">
        &#9888; MOCKUP - Feature Coming Soon
    </div>

    <!-- Fullscreen Video Overlay -->
    <div id="videoOverlay" class="video-overlay-modal">
        <div class="video-overlay-backdrop"></div>
        <div class="video-overlay-content">
            <button class="video-overlay-close" aria-label="Close">&times;</button>
            <video id="overlayVideo" controls playsinline>
                <source src="" type="video/mp4">
            </video>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // ================================================================
        // NOTES FUNCTIONALITY
        // ================================================================

        // Get storage key for notes (customer-specific)
        function getNotesKey(type) {
            return `lvs_customer_notes_mach_${type}`;
        }

        // Save notes to localStorage
        function saveNotes(type) {
            const textarea = document.getElementById(type + 'Notes');
            const metaEl = document.getElementById(type + 'NotesMeta');

            if (!textarea) return;

            const content = textarea.value;
            const key = getNotesKey(type);
            const timestamp = new Date().toISOString();

            const noteData = {
                content: content,
                savedAt: timestamp,
                wordCount: content.trim() ? content.trim().split(/\s+/).length : 0
            };

            try {
                localStorage.setItem(key, JSON.stringify(noteData));

                if (metaEl) {
                    const date = new Date(timestamp);
                    metaEl.textContent = `Saved ${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} • ${noteData.wordCount} words`;
                    metaEl.style.color = 'var(--success)';
                    setTimeout(() => { metaEl.style.color = ''; }, 2000);
                }
            } catch (e) {
                console.error('Failed to save notes:', e);
                if (metaEl) {
                    metaEl.textContent = 'Failed to save';
                    metaEl.style.color = 'var(--error)';
                }
            }
        }

        // Load notes from localStorage
        function loadNotes() {
            const types = ['private'];
            types.forEach(type => {
                const textarea = document.getElementById(type + 'Notes');
                const metaEl = document.getElementById(type + 'NotesMeta');
                if (!textarea) return;

                const key = getNotesKey(type);
                try {
                    const stored = localStorage.getItem(key);
                    if (stored) {
                        const noteData = JSON.parse(stored);
                        textarea.value = noteData.content || '';
                        if (metaEl && noteData.savedAt) {
                            const date = new Date(noteData.savedAt);
                            metaEl.textContent = `Last saved ${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} • ${noteData.wordCount || 0} words`;
                        }
                    }
                } catch (e) {
                    console.error('Failed to load notes:', e);
                }
            });
        }

        // Export notes as text file
        function exportNotes(type) {
            const textarea = document.getElementById(type + 'Notes');
            if (!textarea || !textarea.value.trim()) {
                alert('No notes to export');
                return;
            }

            const date = new Date().toISOString().split('T')[0];
            const filename = `LVS_Mach_${type}_notes_${date}.txt`;
            const content = `LVS Customer Portal - ${type.charAt(0).toUpperCase() + type.slice(1)} Notes
Customer: Mach Industries
Exported: ${new Date().toLocaleString()}
${'='.repeat(50)}

${textarea.value}`;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize user greeting
        function initUserGreeting() {
            const firstName = sessionStorage.getItem('lvs_first_name') || 'User';
            const fullName = sessionStorage.getItem('lvs_user_name') || 'User';
            const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);

            document.getElementById('navGreeting').textContent = `Hi, ${firstName}!`;
            document.getElementById('navAvatar').textContent = initials;
        }

        // Load NDA documents for this customer
        async function loadNdaDocuments() {
            const token = sessionStorage.getItem('lvs_token');
            if (!token) return;

            try {
                const response = await fetch(`${typeof LVS_CONFIG !== 'undefined' ? LVS_CONFIG.API_BASE_URL : 'http://localhost:8080'}/nda/my-documents`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) return;

                const docs = await response.json();
                const approvedDocs = docs.filter(d => d.status === 'approved');

                if (approvedDocs.length > 0) {
                    const panel = document.getElementById('ndaDocsPanel');
                    const list = document.getElementById('ndaDocsList');
                    if (panel && list) {
                        panel.style.display = 'block';
                        list.innerHTML = approvedDocs.map(doc => `
                            <div style="display: flex; align-items: center; gap: 14px; padding: 14px; background: var(--panel-light); border-radius: 10px; margin-bottom: 10px; cursor: pointer;" onclick="downloadNdaDoc(${doc.id})">
                                <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--success);">&#128196;</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 600;">${doc.filename}</div>
                                    <div style="font-size: 11px; color: var(--muted);">Uploaded ${new Date(doc.uploaded_at).toLocaleDateString()}</div>
                                </div>
                                <span style="color: var(--success); font-size: 12px;">&#10003; Approved</span>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading NDA documents:', error);
            }
        }

        async function downloadNdaDoc(docId) {
            const token = sessionStorage.getItem('lvs_token');
            try {
                const response = await fetch(`${typeof LVS_CONFIG !== 'undefined' ? LVS_CONFIG.API_BASE_URL : 'http://localhost:8080'}/nda/${docId}/download`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    const data = await response.json();
                    window.open(data.download_url, '_blank');
                }
            } catch (error) {
                console.error('Error downloading NDA:', error);
            }
        }

        // Demo & Testimonial Videos
        const isMobile = window.innerWidth <= 768;

        // Set all demo videos to 2x speed and autoplay
        document.querySelectorAll('.demo-video').forEach(video => {
            video.playbackRate = 2.0;
            video.play().catch(() => {});
            video.style.cursor = 'pointer';
            video.addEventListener('click', () => {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            });
        });

        // Testimonial videos - hover preview, click for fullscreen overlay
        const testimonialVideos = document.querySelectorAll('.testimonial-video');
        const videoOverlay = document.getElementById('videoOverlay');
        const overlayVideo = document.getElementById('overlayVideo');
        const overlayBackdrop = document.querySelector('.video-overlay-backdrop');
        const overlayClose = document.querySelector('.video-overlay-close');

        function pauseAllTestimonials() {
            testimonialVideos.forEach(v => {
                v.pause();
                v.currentTime = 0;
            });
        }

        function openVideoOverlay(videoSrc) {
            pauseAllTestimonials();
            overlayVideo.src = videoSrc;
            videoOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            overlayVideo.play().catch(() => {});
        }

        function closeVideoOverlay() {
            videoOverlay.classList.remove('active');
            overlayVideo.pause();
            overlayVideo.src = '';
            document.body.style.overflow = '';
        }

        if (overlayClose) overlayClose.addEventListener('click', closeVideoOverlay);
        if (overlayBackdrop) overlayBackdrop.addEventListener('click', closeVideoOverlay);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && videoOverlay && videoOverlay.classList.contains('active')) {
                closeVideoOverlay();
            }
        });

        testimonialVideos.forEach(video => {
            video.playbackRate = 1.0;
            video.loop = true;
            video.style.cursor = 'pointer';
            const videoSrc = video.querySelector('source')?.src || video.src;
            video.addEventListener('click', (e) => {
                e.preventDefault();
                openVideoOverlay(videoSrc);
            });
            if (!isMobile) {
                video.addEventListener('mouseenter', () => {
                    pauseAllTestimonials();
                    video.play().catch(() => {});
                });
                video.addEventListener('mouseleave', () => {
                    video.pause();
                    video.currentTime = 0;
                });
            }
        });

        // Load notes on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize shared tabs (Product, Specs, DevKit, SDK, Support, Demos, Testimonials)
            LVSSharedTabs.init();
            // Initialize NDA gating
            LVSNDAGate.init('mach');
            loadNotes();
            initUserGreeting();
            loadNdaDocuments();
            // Initialize shared account notes
            LVSComments.init('mach', '#accountCommentsContainer');
        });
    </script>
</body>
</html>
